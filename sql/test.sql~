

-- get metro line: "Салтовская линия"
/*
select bus.nodes.ru_name,bus.nodes.street_name,bus.nodes.lat,bus.nodes.lon from 
 ( select curr_node_id,index from bus.route_way_nodes where route_way_id in 
                       (select bus.route_ways.id from bus.route_ways JOIN bus.routes ON bus.routes.id = bus.route_ways.route_id
                        where direct_type = B'0' AND ru_number='Салтовская линия')
) as virtTable

JOIN bus.nodes ON bus.nodes.id = virtTable.curr_node_id
ORDER BY index;

*/
/*
  select * from 
  (
     select * from bus.route_schedule JOIN 
     (select * from bus.route_way_days where day_id in (select id from bus.days where ru_name = 'Понедельник')) as rwdays
          ON rwdays.route_daygroup_id =  bus.route_schedule.route_daygroup_id
       JOIN bus.route_ways ON bus.route_ways.id = rwdays.route_way_id
       JOIN bus.routes ON bus.route_ways.route_id = bus.routes.id
  ) as tempTable;
  
  */

  
SELECT table1.ru_number,table1.cur_station, ru_name as next_station,time_in FROM 
(
           SELECT   bus.routes.ru_number,ru_name as cur_station,curr_node_id,distance,base_cost,ind,table2.time_in as time_in FROM 
           bus.calc_dejkstra('Харьков','с.м. Героев труда','с.м. Спортивная','Понедельник','12:00',2) as table2
           JOIN bus.route_way_nodes ON bus.route_way_nodes.id = table2.route_way_id
           JOIN bus.route_ways      ON bus.route_ways.id = bus.route_way_nodes.route_way_id
           JOIN bus.routes          ON bus.routes.id =  bus.route_ways.route_id
           JOIN bus.nodes           ON bus.nodes.id = bus.route_way_nodes.prev_node_id
           ORDER BY ind DESC
) as table1 
JOIN bus.nodes ON bus.nodes.id = table1.curr_node_id;             












/*
SELECT wayTable.ru_name, bus.nodes.ru_name ,time,distance from
(SELECT * from bus.route_way_nodes JOIN bus.nodes ON bus.route_way_nodes.curr_node_id = bus.nodes.id
                                   JOIN bus.route_ways ON bus.route_ways.id = bus.route_way_nodes.route_way_id
                                   JOIN bus.routes ON bus.routes.id = bus.route_ways.route_id

                                   WHERE bus.routes.ru_number = 'Салтовская линия' AND
                                         bus.route_ways.direct_type = B'0'
) as wayTable
                                  JOIN bus.nodes ON wayTable.prev_node_id = bus.nodes.id;*/

    /* SELECT sum(distance) from
(SELECT * from bus.route_way_nodes JOIN bus.nodes ON bus.route_way_nodes.curr_node_id = bus.nodes.id
                                   JOIN bus.route_ways ON bus.route_ways.id = bus.route_way_nodes.route_way_id
                                   JOIN bus.routes ON bus.routes.id = bus.route_ways.route_id

                                   WHERE bus.routes.ru_number = 'Салтовская линия' AND
                                         bus.route_ways.direct_type = B'0'
) as wayTable
                                  JOIN bus.nodes ON wayTable.prev_node_id = bus.nodes.id;*/    
